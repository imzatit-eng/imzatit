const express = require('express');
const router = express.Router();
const authMiddleware = require('../middleware/auth');

// التحكمات
const authController = require('../controllers/authController');
const orderController = require('../controllers/orderController');
const paymentController = require('../controllers/paymentController');
const cryptoController = require('../controllers/cryptoController');
const userController = require('../controllers/userController');

// === مسارات المصادقة ===
router.post('/auth/register', authController.register);
router.post('/auth/login', authController.login);
router.post('/auth/verify-email', authController.verifyEmail);
router.post('/auth/forgot-password', authController.forgotPassword);
router.post('/auth/reset-password', authController.resetPassword);

// === مسارات المستخدم ===
router.get('/users/profile', authMiddleware, userController.getProfile);
router.put('/users/profile', authMiddleware, userController.updateProfile);
router.get('/users/wallet', authMiddleware, userController.getWallet);

// === مسارات الطلبات ===
router.post('/orders', authMiddleware, orderController.createOrder);
router.get('/orders', authMiddleware, orderController.getOrders);
router.get('/orders/:orderId', authMiddleware, orderController.getOrderStatus);
router.put('/orders/:orderId/cancel', authMiddleware, orderController.cancelOrder);

// === مسارات الدفع ===
router.post('/payments/initiate', authMiddleware, paymentController.initiatePayment);
router.post('/payments/webhook', paymentController.webhookHandler);
router.get('/payments/methods', paymentController.getPaymentMethods);

// === مسارات العملات الرقمية ===
router.get('/crypto/balance', authMiddleware, cryptoController.getBalance);
router.post('/crypto/transfer', authMiddleware, cryptoController.transfer);
router.get('/crypto/rate', cryptoController.getExchangeRate);
router.get('/crypto/transactions', authMiddleware, cryptoController.getTransactions);

// === مسارات النظام ===
router.get('/system/health', (req, res) => {
  res.json({
    status: 'healthy',
    timestamp: new Date().toISOString(),
    version: '1.0.0'
  });
});

router.get('/system/config', authMiddleware, (req, res) => {
  res.json({
    platform: 'Imzatit Sovereign Platform',
    languages: ['ar', 'en'],
    currencies: ['USD', 'LYD', 'BHD', 'TIT'],
    features: ['automation', 'crypto', 'marketing', 'ai']
  });
});

module.exports = router;